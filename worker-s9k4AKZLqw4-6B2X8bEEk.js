(()=>{var t=[,(t,e,a)=>{const r=a(2),o=a(4),n=a(5),s=a(6),i=a(7),c=a(8),l=a(9),p=a(10);t.exports={fetchEtas:async({route:t,stops:e,bound:a,dest:h,seq:d,serviceType:u,co:m,nlbId:g,gtfsId:f,language:b})=>{try{let v=[];for(const w of m)"kmb"===w&&e.kmb?v=v.concat(await r.fetchEtas({route:t,stopId:e.kmb[d],seq:d,serviceType:u,bound:a[w]})):"ctb"===w&&e.ctb?v=v.concat(await n.fetchEtas({stopId:e.ctb[d],route:t,bound:a[w],seq:d})):"nwfb"===w&&e.nwfb?v=v.concat(await o.fetchEtas({stopId:e.nwfb[d],route:t,bound:a[w],seq:d})):"nlb"===w&&e.nlb?v=v.concat(await s.fetchEtas({stopId:e.nlb[d],nlbId:g})):"lrtfeeder"===w&&e.lrtfeeder?v=v.concat(await i.fetchEtas({stopId:e.lrtfeeder[d],route:t,language:b})):"gmb"===w&&e.gmb?v=v.concat(await c.fetchEtas({stopId:e.gmb[d],gtfsId:f,seq:d,bound:a[w]})):"lightRail"===w&&e.lightRail?v=v.concat(await l.fetchEtas({stopId:e.lightRail[d],route:t,dest:h})):"mtr"===w&&e.mtr&&(v=v.concat(await p.fetchEtas({stopId:e.mtr[d],route:t,bound:a.mtr})));return v.sort(((t,e)=>""===t.eta?1:""===e.eta||t.eta<e.eta?-1:1))}catch(t){return console.error(t),[]}},fetchEtaObj:()=>fetch("https://hkbus.github.io/hk-bus-crawling/routeFareList.min.json").then((t=>t.json())),fetchEtaObjMd5:()=>fetch("https://hkbus.github.io/hk-bus-crawling/routeFareList.md5").then((t=>t.text()))}},(t,e,a)=>{const r=a(3);t.exports={co:"kmb",fetchEtas:({stopId:t,route:e,seq:a,serviceType:o,bound:n})=>fetch(`https://data.etabus.gov.hk/v1/transport/kmb/eta/${t}/${e}/${o}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.filter((t=>null!==t.eta&&t.dir===n&&t.seq===a+1)).map((t=>({eta:t.eta,remark:{zh:t.rmk_tc,en:t.rmk_en},co:"kmb"}))))),fetchStopEtas:t=>fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/${t}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.map((t=>({route:t.route,bound:t.dir,seq:t.seq,eta:t.eta,dest:{zh:t.dest_tc,en:t.dest_en},remark:{zh:t.rmk,en:t.rmk},serviceType:t.service_type,co:"kmb"})))))}},t=>{t.exports={isSafari:navigator&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!(navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/"))}},(t,e,a)=>{const r=a(3);t.exports={co:"nwfb",fetchEtas:({stopId:t,route:e,bound:a,seq:o})=>fetch(`https://rt.data.gov.hk//v1/transport/citybus-nwfb/eta/NWFB/${t}/${e}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.filter((t=>t.eta&&a.includes(t.dir))).sort(((t,e)=>Math.abs(t.seq-o)<Math.abs(e.seq-o)?-1:1)).filter(((t,e,a)=>t.seq===a[0].seq)).map((t=>({eta:t.eta,remark:{zh:t.rmk_tc,en:t.rmk_en},co:"nwfb"}))))),fetchStopEtas:t=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${t}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.map((t=>({route:t.route,bound:t.dir,seq:t.seq,eta:t.eta,dest:{en:t.dest.replace("/","／")},remark:{en:t.rmk},serviceType:1,co:"nwfb"})))))}},(t,e,a)=>{const r=a(3);t.exports={co:"ctb",fetchEtas:({stopId:t,route:e,bound:a,seq:o})=>fetch(`https://rt.data.gov.hk//v1/transport/citybus-nwfb/eta/CTB/${t}/${e}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.filter((t=>t.eta&&a.includes(t.dir))).sort(((t,e)=>Math.abs(t.seq-o)<Math.abs(e.seq-o)?-1:1)).filter(((t,e,a)=>t.seq===a[0].seq)).map((t=>({eta:t.eta,remark:{zh:t.rmk_tc,en:t.rmk_en},co:"ctb"}))))),fetchStopEtas:t=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${t}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.map((t=>({route:t.route,bound:t.dir,seq:t.seq,eta:t.eta,dest:{en:t.dest.replace("/","／")},remark:{en:t.rmk},serviceType:1,co:"ctb"})))))}},(t,e,a)=>{const r=a(3);t.exports={co:"nlb",fetchEtas:({stopId:t,nlbId:e})=>fetch("https://rt.data.gov.hk/v1/transport/nlb/stop.php?action=estimatedArrivals",{body:JSON.stringify({routeId:e,stopId:t,language:"zh"}),headers:{"Content-Type":"text/plain"},method:"POST",cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({estimatedArrivals:t})=>t?t.filter((t=>t.estimatedArrivalTime)).map((t=>({eta:t.estimatedArrivalTime.replace(" ","T")+".000+08:00",remark:{zh:"",en:""},co:"nlb"}))):[])),fetchStopEtas:t=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NLB/${t}`,{cache:"reload"}).then((t=>{if(t.ok)return t.json();throw new Error("Stop not exist")})).then((({data:t})=>t.map((t=>({route:t.route,eta:t.eta,dest:{en:t.dest},remark:{en:t.rmk},co:"nlb"}))))).catch((()=>[]))}},(t,e,a)=>{const r=a(3);t.exports={co:"lrtfeeder",fetchEtas:({stopId:t,route:e,language:a})=>fetch("https://rt.data.gov.hk/v1/transport/mtr/bus/getSchedule",{method:"POST",cache:r.isSafari?"default":"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:a,routeName:e})}).then((t=>t.json())).then((({busStop:e})=>e.filter((({busStopId:e})=>e===t)).reduce(((t,{bus:e})=>[...t,...e.reduce(((t,e)=>{const r=new Date(Date.now()+1e3*parseInt("108000"===e.arrivalTimeInSecond?e.departureTimeInSecond:e.arrivalTimeInSecond,10)+288e5);return[...t,{eta:`${r.getUTCFullYear()}-${`0${r.getUTCMonth()+1}`.slice(-2)}-${`0${r.getUTCDate()}`.slice(-2)}T${`0${r.getUTCHours()}`.slice(-2)}:${`0${r.getMinutes()}`.slice(-2)}:${`0${r.getSeconds()}`.slice(-2)}+08:00`,remark:{[a]:e.busRemark||("1"===e.isScheduled?"en"===a?"Scheduled":"預定班次":"")},co:"lrtfeeder"}]}),[])]),[]))),fetchStopEtas:t=>[]}},(t,e,a)=>{const r=a(3);t.exports={co:"gmb",fetchEtas:({gtfsId:t,stopId:e,bound:a,seq:o})=>fetch(`https://data.etagmb.gov.hk/eta/route-stop/${t}/${e}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:t})=>t.filter((({route_seq:t})=>"O"===a&&1===t||"I"===a&&2===t)).filter((({stop_seq:t})=>t===o+1)).reduce(((t,{eta:e})=>[...t,...e.map((t=>({eta:t.timestamp,remark:{zh:t.remarks_tc,en:t.remarks_en},co:"gmb"})))]),[]))),fetchStopEtas:t=>[]}},(t,e,a)=>{const r=a(3);t.exports={co:"lightRail",fetchEtas:({stopId:t,route:e,dest:a})=>fetch(`https://rt.data.gov.hk/v1/transport/mtr/lrt/getSchedule?station_id=${t.slice(2)}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({platform_list:t})=>t.reduce(((t,{route_list:r,platform_id:o})=>[...t,...r.filter((({route_no:t,dest_ch:r,dest_en:o,stop:n})=>e===t&&(r===a.zh||o.includes("Circular"))&&0===n)).map((({time_en:t})=>{let e=0;switch(t.toLowerCase()){case"arriving":case"departing":case"-":e=0;break;default:e=parseInt(t,10)}const a=new Date(Date.now()+60*e*1e3+288e5);return{eta:`${a.getUTCFullYear()}-${`0${a.getUTCMonth()+1}`.slice(-2)}-${`0${a.getUTCDate()}`.slice(-2)}T${`0${a.getUTCHours()}`.slice(-2)}:${`0${a.getMinutes()}`.slice(-2)}:${`0${a.getSeconds()}`.slice(-2)}+08:00`,remark:{zh:`${o}號月台`,en:`Platform ${o}`},co:"lightRail"}}),[])]),[]))).catch((t=>(console.error(t),[]))),fetchStopEtas:t=>[]}},(t,e,a)=>{const r=a(3);t.exports={co:"mtr",fetchEtas:({stopId:t,route:e,bound:a})=>fetch(`https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?line=${e}&sta=${t}`,{cache:r.isSafari?"default":"no-store"}).then((t=>t.json())).then((({data:r,status:o})=>0===o?[]:r[`${e}-${t}`]["U"===a.slice(-2,1)?"UP":"DOWN"].reduce(((t,{time:e,plat:a,dest:r})=>[...t,{eta:e.replace(" ","T")+"+08:00",remark:{zh:`${a}號月台`,en:`Platform ${a}`},co:"mtr"}]),[]))),fetchStopEtas:t=>[]}},(t,e,a)=>{"use strict";a.r(e),a.d(e,{binarySearch:()=>b,checkAppInstalled:()=>k,checkMobile:()=>c,checkPosition:()=>s,getDistance:()=>r,getDistanceWithUnit:()=>o,getTileListURL:()=>v,isEmptyObj:()=>m,isWarnUpMessageData:()=>w,lat2tile:()=>f,locationEqual:()=>i,lon2tile:()=>g,reorder:()=>y,routeSortFunc:()=>S,setSeoHeader:()=>d,toProperCase:()=>u,triggerShare:()=>p,triggerShareImg:()=>h,vibrate:()=>l});const r=(t,e)=>{const a=t.lat*Math.PI/180,r=e.lat*Math.PI/180,o=(e.lat-t.lat)*Math.PI/180,n=(e.lng-t.lng)*Math.PI/180,s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(a)*Math.cos(r)*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},o=(t,e)=>{const a=r(t,e);return a>=1e3?{distance:a/1e3,unit:"公里",decimalPlace:1}:{distance:a,unit:"米",decimalPlace:0}},n={lat:22.302711,lng:114.177216},s=t=>t&&"number"==typeof t.lat&&isFinite(t.lat)&&"number"==typeof t.lng&&isFinite(t.lng)?t:n,i=(t,e)=>Math.abs(t.lat-e.lat)<1e-7&&Math.abs(t.lng-e.lng)<1e-7,c=()=>{let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},l=t=>{"vibrate"in navigator&&navigator.vibrate(t)},p=(t,e)=>navigator.share?navigator.share({title:e,url:t}):navigator.clipboard?navigator.clipboard.writeText(t):new Promise((t=>t(""))),h=async(t,e,a)=>{const r=await fetch(t).then((t=>t.blob())),o=new File([r],"hkbus.png",{type:r.type});return navigator.share?navigator.share({title:e,text:a,files:[o]}):navigator.clipboard?navigator.clipboard.write([new ClipboardItem({"image/png":r})]):void 0},d=({title:t,description:e,lang:a})=>{document.querySelector('meta[name="description"]')&&(document.title=t,document.querySelector('meta[name="description"]').setAttribute("content",e),document.querySelector('link[rel="canonical"]').setAttribute("href",`https://hkbus.app${window.location.pathname}`),document.querySelector("html").setAttribute("lang","zh"===a?"zh-Hant":a),document.querySelector('link[rel="alternative"][hreflang="en"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace(`/${a}`,"/en")),document.querySelector('link[rel="alternative"][hreflang="zh-Hant"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace(`/${a}`,"/zh")),document.querySelector('link[rel="alternative"][hreflang="x-default"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace(`/${a}`,"/zh")),document.querySelector('meta[property="og:title"]').setAttribute("content",t),document.querySelector('meta[property="og:url"]').setAttribute("content",`https://hkbus.app${window.location.pathname}`),document.querySelector('meta[property="og:description"]').setAttribute("content",e),document.querySelector('meta[name="twitter:title"]').setAttribute("content",t),document.querySelector('meta[name="twitter:description"]').setAttribute("content",e))},u=t=>t.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})),m=t=>t&&0===Object.keys(t).length&&t.constructor===Object;function g(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}function f(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}const b=(t,e,a)=>{let r=0,o=t.length-1;for(;r<=o;){let n=o+r>>1,s=a(e,t[n]);if(s>0)r=n+1;else{if(!(s<0))return n;o=n-1}}return-r-1},v=(t,e,a)=>{const r=255*(t+5)*(t+5),o=(t,e)=>e.key-t.key;return e.map((e=>{const a=g(e.location.lng,t),o=f(e.location.lat,t);return{key:a*r+o,x:a,y:o}})).sort(o).reduce(((t,e)=>(b(t,e,o)<0&&t.push(e),t)),[]).flatMap((e=>["https://cartodb-basemaps-a.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png".replaceAll("{s}","a").replaceAll("{x}",String(e.x)).replaceAll("{y}",String(e.y)).replaceAll("{z}",String(t)).replaceAll("{r}",a?"@2x":""),"https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png".replaceAll("{s}","a").replaceAll("{x}",String(e.x)).replaceAll("{y}",String(e.y)).replaceAll("{z}",String(t)).replaceAll("{r}",a?"@2x":"")]))},w=t=>"object"==typeof t&&"WARN_UP_MAP_CACHE"===t.type,k=()=>{if(window.matchMedia("(display-mode: standalone)").matches)return!0;const t=window.navigator.standalone,e=window.navigator.userAgent.toLowerCase(),a=/safari/.test(e);if(/iphone|ipod|ipad/.test(e)){if(!t&&a);else if(!t&&!a)return!0}else if(e.includes("wv"))return!0;return!1},y=(t,e,a)=>{const r=Array.from(t),[o]=r.splice(e,1);return r.splice(a,0,o),r},S=(t,e,a)=>{const r=t[0].split("-"),o=e[0].split("-");if(+r[0].replaceAll(/[A-z]$/gi,"")>+o[0].replaceAll(/[A-z]$/gi,""))return 1;if(+r[0].replaceAll(/[A-z]$/gi,"")<+o[0].replaceAll(/[A-z]$/gi,""))return-1;if(r[0].replaceAll(/[0-9]/gi,"")>o[0].replaceAll(/[0-9]/gi,""))return 1;if(r[0].replaceAll(/[0-9]/gi,"")<o[0].replaceAll(/[0-9]/gi,""))return-1;if(+r[0].replaceAll(/[A-z]/gi,"")>+o[0].replaceAll(/[A-z]/gi,""))return 1;if(+r[0].replaceAll(/[A-z]/gi,"")<+o[0].replaceAll(/[A-z]/gi,""))return-1;const n=t[1].co.sort(((t,e)=>a.indexOf(t)-a.indexOf(e))),s=e[1].co.sort(((t,e)=>a.indexOf(t)-a.indexOf(e)));return a.indexOf(n[0])>a.indexOf(s[0])?1:a.indexOf(n[0])<a.indexOf(s[0])?-1:r[1]>o[1]?1:-1}}],e={};function a(r){var o=e[r];if(void 0!==o)return o.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,a),n.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";a.r(r);var t=a(1),e=a(11);self.addEventListener("message",(a=>{if(a.data&&"CHECK_VERSION"===a.data.type){const t="138";self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((e=>e.map((e=>e.postMessage({type:"CURRENT_VERSION",payload:`build ${t}`})))))}const r=a.data;if((0,e.isWarnUpMessageData)(r)){console.log("warm up map cache",r);const o=async()=>{try{await(async(a,r,o,n)=>{try{let r;if(void 0===n){const e=await(0,t.fetchEtaObj)();r=Object.values(e.stopList)}else r=n;const s=await caches.open("map");await Promise.all(a.map((async t=>{const a=(0,e.getTileListURL)(t,r,o),n=async(t,e)=>{for(let r=t;r<a.length;r+=e)void 0===await s.match(a[r])&&await s.add(a[r])};let i=[];for(let t=0;t<10;t+=1)i.push(n(t,10));await Promise.all(i)})))}catch(t){console.error("error on warn cache",t)}})(r.zoomLevels,0,r.retinaDisplay,r.stopList)}catch(t){console.error("error on warn cache",t)}};a.waitUntil(o())}}))})()})();