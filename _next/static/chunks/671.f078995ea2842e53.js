"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[671],{2638:function(g,b,a){var c=a(5318);b.Z=void 0;var d=c(a(4938)),e=a(5893),f=(0,d.default)((0,e.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}),"MyLocation");b.Z=f},6671:function(k,f,a){a.r(f);var h=a(4051),c=a.n(h),l=a(5893),m=a(7294),i=a(5152),d=a.n(i),n=a(5243),o=a(1567),j=a(7357),g=a(948),p=a(2970),q=a(2638),r=a(8473),s=a(5715);function t(c,d,e,f,g,h,i){try{var a=c[h](i),b=a.value}catch(j){e(j);return}a.done?d(b):Promise.resolve(b).then(f,g)}function e(a){return function(){var b=this,c=arguments;return new Promise(function(e,f){var g=a.apply(b,c);function d(a){t(g,e,f,d,h,"next",a)}function h(a){t(g,e,f,d,h,"throw",a)}d(void 0)})}}function u(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var v=d()(e(c().mark(function b(){return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,a.e(149).then(a.bind(a,3149));case 2:return b.abrupt("return",b.sent.Marker);case 3:case"end":return b.stop()}},b)})),{loadableGenerated:{webpack:function(){return[3149]}},ssr:!1}),w=d()(e(c().mark(function b(){return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,a.e(149).then(a.bind(a,3149));case 2:return b.abrupt("return",b.sent.TileLayer);case 3:case"end":return b.stop()}},b)})),{loadableGenerated:{webpack:function(){return[3149]}},ssr:!1}),x=d()(e(c().mark(function b(){return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,a.e(149).then(a.bind(a,3149));case 2:return b.abrupt("return",b.sent.Polyline);case 3:case"end":return b.stop()}},b)})),{loadableGenerated:{webpack:function(){return[3149]}},ssr:!1}),y=d()(e(c().mark(function b(){return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,a.e(149).then(a.bind(a,3149));case 2:return b.abrupt("return",b.sent.Circle);case 3:case"end":return b.stop()}},b)})),{loadableGenerated:{webpack:function(){return[3149]}},ssr:!1}),z=function(a){var d=a.center,e=a.start,c=a.end,b=a.map;return d?null==b||b.flyTo((0,r.bf)(d)):c&&(null==b||b.fitBounds((0,n.latLngBounds)((0,n.latLng)(e.lat,e.lng),(0,n.latLng)(c.lat,c.lng)))),(0,l.jsx)(l.Fragment,{})},A=function(){var a=(0,m.useContext)(p.Z),b=a.geolocation,c=a.geoPermission;return"granted"!==c?null:(0,l.jsx)(y,{center:(0,r.bf)(b),radius:25})},B=function(b){var a=b.start;return a?(0,l.jsx)(v,{position:a,icon:I({isStart:!0})}):null},C=function(b){var a=b.end;return a?(0,l.jsx)(v,{position:a,icon:I({isStart:!1})}):null},D=function(a){var b=a.onClick;return(0,l.jsx)("div",{className:"leaflet-bottom leaflet-right",children:(0,l.jsx)(L,{className:"".concat(J.centralControlContainer," leaflet-control leaflet-bar"),onClick:b,children:(0,l.jsx)(q.Z,{className:J.centralControl})})})},E=function(a){var b,c,d,e=a.route,f=e.routeId,h=e.on,i=e.off,k=a.lv,n=a.stopIdx,q=a.onMarkerClick,j=(0,m.useContext)(p.Z).db,s=(0,o.$)().i18n,g=Object.values(null!==(d=null===(b=j.routeList)|| void 0===b?void 0:null===(c=b[f])|| void 0===c?void 0:c.stops)&& void 0!==d?d:{}).sort(function(a,b){return b.length-a.length})[0].slice(h,i+1),t=f.split("-")[0];return(0,l.jsxs)(l.Fragment,{children:[g.map(function(b,a){var c,d,e;return(0,l.jsx)(v,{position:null===(c=j.stopList)|| void 0===c?void 0:null===(d=c[b])|| void 0===d?void 0:d.location,icon:H({active:n===a,passed:a<n,lv:k}),alt:"".concat(a,". ").concat(t," - ").concat(null===(e=j.stopList)|| void 0===e?void 0:e[b].name[s.language]),eventHandlers:{click:function(b){q(f,a)}}},"".concat(b,"-").concat(a))}),g.slice(1).map(function(c,d){var a,b;return(0,l.jsx)(x,{positions:[G((0,r.bf)(null===(a=j.stopList)|| void 0===a?void 0:a[g[d]].location)),G((0,r.bf)(null===(b=j.stopList)|| void 0===b?void 0:b[c].location)),],color:0===k?"#FF9090":"#d0b708"},"".concat(c,"-line"))})]})},F=function(c){var h=c.routes,d=c.start,e=c.end,i=(0,m.useContext)(p.Z),f=i.db,j=f.routeList,k=f.stopList,g=[],a=[];if(!(d&&e))return(0,l.jsx)(l.Fragment,{});a.push(d),(h||[]).forEach(function(b){var d=b.routeId,e=b.on,f=b.off,c=Object.values(j[d].stops).sort(function(a,b){return b.length-a.length})[0];a.push(k[c[e]].location),a.push(k[c[f]].location)}),a.push(e||d);for(var b=0;b<a.length/2;++b)g.push([a[2*b],a[2*b+1]]);return(0,l.jsx)(l.Fragment,{children:g.map(function(a,b){return(0,l.jsx)(x,{positions:[G(a[0]),G(a[1])],color:"green"},"line-".concat(b))})})};f.default=function(c){var f=c.routes,a=c.start,b=c.end,v=c.stopIdx,x=c.onMarkerClick,d=(0,m.useContext)(p.Z),n=d.geolocation,y=d.geoPermission,G=d.updateGeoPermission,o=d.colorMode,g=(0,m.useState)({center:null,isFollow:!1}),h=g[0],q=g[1],e=h.center,t=h.isFollow,i=(0,m.useState)(null),j=i[0],u=i[1],k=(0,m.useCallback)(function(a){var b=null!=a?a:{},c=b.center,d=b.isFollow;q({center:c||(null==j?void 0:j.getCenter()),isFollow:d||!1})},[q]);return(0,m.useEffect)(function(){if(j){var a=function(){k({center:j.getCenter()})};return j.on({dragend:a}),function(){j.off({dragend:a})}}},[j,k]),(0,m.useEffect)(function(){t&&(e&&n.lat===e.lat&&n.lng===e.lng||k({center:n,isFollow:!0}))},[n,e,t,k]),(0,l.jsx)(K,{className:J.mapContainerBox,children:(0,l.jsxs)(s.h,{center:e||(a&&b?{lat:(a.lat+b.lat)/2,lng:(a.lng+b.lng)/2}:(0,r.bf)(a)),zoom:16,scrollWheelZoom:!1,className:J.mapContainer,ref:u,children:[(0,l.jsx)(z,{map:j,center:e,start:(0,r.bf)(a),end:b}),(0,l.jsx)(w,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors \xa9 <a href="https://carto.com/attributions">CARTO</a>',url:"dark"===o?"https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png":"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png"}),(f||[]).map(function(b,a){return(0,l.jsx)(E,{route:b,lv:a,stopIdx:v[a],onMarkerClick:x},"route-".concat(a))}),(0,l.jsx)(F,{routes:f,start:a,end:b}),(0,l.jsx)(A,{}),(0,l.jsx)(B,{start:a}),(0,l.jsx)(C,{end:b}),(0,l.jsx)(D,{onClick:function(){"granted"===y?k({isFollow:!0}):"denied"!==y&&(k({isFollow:!0}),G("opening"))}})]})})};var G=function(a){var b=a.lat,c=a.lng;return[b,c]},H=function(a){var b=a.active,c=a.passed,d=a.lv;return(0,n.icon)({iconUrl:"/icons/marker-icon-2x.png",className:"".concat(J.marker," ").concat(b?J.active:""," ").concat(c?J.passed:""," lv-").concat(d)})},I=function(a){var b=a.isStart;return(0,n.icon)({iconUrl:"/icons/marker-icon-2x.png",className:"".concat(J.marker," ").concat(b?"start":"end")})},b="searchMap",J={mapContainerBox:"".concat(b,"-mapContainerBox"),mapContainer:"".concat(b,"-mapContainer"),centralControlContainer:"".concat(b,"-centralControlContainer"),centralControl:"".concat(b,"-centralControl"),marker:"".concat(b,"-marker"),active:"".concat(b,"-active"),passed:"".concat(b,"-passed")},K=(0,g.ZP)(j.Z)(function(b){var a,c=b.theme;return u(a={},"&.".concat(J.mapContainerBox),{height:"30vh",filter:"dark"===c.palette.mode?"brightness(0.8)":"none"}),u(a,"& .".concat(J.mapContainer),{height:"30vh"}),u(a,"& .".concat(J.marker),{marginLeft:"-12px",marginTop:"-41px",width:"25px",height:"41px",zIndex:618,outline:"none",filter:"hue-rotate(130deg)","&.lv-1":{filter:"hue-rotate(210deg) brightness(1.5)"},"&.start":{filter:"hue-rotate(30deg)"},"&.end":{filter:"hue-rotate(280deg)"}}),u(a,"& .".concat(J.active),{animation:"blinker 2s linear infinite"}),u(a,"& .".concat(J.passed),{filter:"grayscale(100%)"}),a}),L=(0,g.ZP)("div")(function(b){var a;return b.theme,u(a={},"& .".concat(J.centralControl),{padding:"5px",color:"black"}),u(a,"&.".concat(J.centralControlContainer),{background:"white",height:"28px",marginBottom:"20px !important",marginRight:"5px !important"}),a})},1410:function(e,b,a){a.d(b,{Hb:function(){return f},UO:function(){return h},mE:function(){return i},sj:function(){return g}});var c=a(7294);function f(a){return Object.freeze({__version:1,map:a})}function g(a,b){return Object.freeze({...a,...b})}let d=(0,c.createContext)(null),h=d.Provider;function i(){let a=(0,c.useContext)(d);if(null==a)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return a}},5715:function(d,b,a){a.d(b,{h:function(){return h}});var e=a(1410),f=a(5243),c=a(7294);function g(){return(g=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}let h=(0,c.forwardRef)(function({bounds:o,boundsOptions:p,center:q,children:b,className:d,id:h,placeholder:i,style:j,whenReady:r,zoom:s,...t},k){let[l]=(0,c.useState)({className:d,id:h,style:j}),[a,u]=(0,c.useState)(null);(0,c.useImperativeHandle)(k,()=>a?.map??null,[a]);let m=(0,c.useCallback)(c=>{if(null!==c&&null===a){let b=new f.Map(c,t);null!=q&&null!=s?b.setView(q,s):null!=o&&b.fitBounds(o,p),null!=r&&b.whenReady(r),u((0,e.Hb)(b))}},[]);(0,c.useEffect)(()=>()=>{a?.map.remove()},[]);let n=a?c.createElement(e.UO,{value:a},b):i??null;return c.createElement("div",g({},l,{ref:m}),n)})}}])