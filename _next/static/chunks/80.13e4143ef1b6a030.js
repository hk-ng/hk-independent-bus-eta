(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80],{7783:function(a,c,b){let d=b(7934);a.exports={co:"ctb",fetchEtas:({stopId:a,route:b,bound:c,seq:e})=>fetch(`https://rt.data.gov.hk//v1/transport/citybus-nwfb/eta/CTB/${a}/${b}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.filter(a=>a.eta&&c.includes(a.dir)).sort((a,b)=>Math.abs(a.seq-e)<Math.abs(b.seq-e)?-1:1).filter((a,c,b)=>a.seq===b[0].seq).map(a=>({eta:a.eta,remark:{zh:a.rmk_tc,en:a.rmk_en},co:"ctb"}))),fetchStopEtas:a=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${a}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.map(a=>({route:a.route,bound:a.dir,seq:a.seq,eta:a.eta,dest:{en:a.dest.replace("/","\uFF0F")},remark:{en:a.rmk},serviceType:1,co:"ctb"})))}},7238:function(a,c,b){let d=b(7934);a.exports={co:"gmb",fetchEtas:({gtfsId:a,stopId:b,bound:c,seq:e})=>fetch(`https://data.etagmb.gov.hk/eta/route-stop/${a}/${b}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.filter(({route_seq:a})=>"O"===c&&1===a||"I"===c&&2===a).filter(({stop_seq:a})=>a===e+1).reduce((a,{eta:b})=>[...a,...b.map(a=>({eta:a.timestamp,remark:{zh:a.remarks_tc,en:a.remarks_en},co:"gmb"}))],[])),fetchStopEtas:a=>[]}},9271:function(a,c,b){let d=b(7934);a.exports={co:"kmb",fetchEtas:({stopId:a,route:b,seq:e,serviceType:c,bound:f})=>fetch(`https://data.etabus.gov.hk/v1/transport/kmb/eta/${a}/${b}/${c}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.filter(a=>null!==a.eta&&a.dir===f&&a.seq===e+1).map(a=>({eta:a.eta,remark:{zh:a.rmk_tc,en:a.rmk_en},co:"kmb"}))),fetchStopEtas:a=>fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/${a}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.map(a=>({route:a.route,bound:a.dir,seq:a.seq,eta:a.eta,dest:{zh:a.dest_tc,en:a.dest_en},remark:{zh:a.rmk,en:a.rmk},serviceType:a.service_type,co:"kmb"})))}},2599:function(a,c,b){let d=b(7934);a.exports={co:"lightRail",fetchEtas:({stopId:a,route:b,dest:c})=>fetch(`https://rt.data.gov.hk/v1/transport/mtr/lrt/getSchedule?station_id=${a.slice(2)}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({platform_list:a})=>a.reduce((a,{route_list:d,platform_id:e})=>[...a,...d.filter(({route_no:a,dest_ch:d,dest_en:e,stop:f})=>b===a&&(d===c.zh||e.includes("Circular"))&&0===f).map(({time_en:c})=>{let b=0;switch(c.toLowerCase()){case"arriving":case"departing":case"-":b=0;break;default:b=parseInt(c,10)}let a=new Date(Date.now()+6e4*b+288e5);return{eta:`${a.getUTCFullYear()}-${`0${a.getUTCMonth()+1}`.slice(-2)}-${`0${a.getUTCDate()}`.slice(-2)}T${`0${a.getUTCHours()}`.slice(-2)}:${`0${a.getMinutes()}`.slice(-2)}:${`0${a.getSeconds()}`.slice(-2)}+08:00`,remark:{zh:`${e}號月台`,en:`Platform ${e}`},co:"lightRail"}},[])],[])).catch(a=>(console.error(a),[])),fetchStopEtas:a=>[]}},8453:function(a,c,b){let d=b(7934);a.exports={co:"lrtfeeder",fetchEtas:({stopId:c,route:a,language:b})=>fetch("https://rt.data.gov.hk/v1/transport/mtr/bus/getSchedule",{method:"POST",cache:d.isSafari?"default":"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:b,routeName:a})}).then(a=>a.json()).then(({busStop:a})=>a.filter(({busStopId:a})=>a===c).reduce((a,{bus:c})=>[...a,...c.reduce((d,c)=>{let a=new Date(Date.now()+1e3*parseInt("108000"===c.arrivalTimeInSecond?c.departureTimeInSecond:c.arrivalTimeInSecond,10)+288e5);return[...d,{eta:`${a.getUTCFullYear()}-${`0${a.getUTCMonth()+1}`.slice(-2)}-${`0${a.getUTCDate()}`.slice(-2)}T${`0${a.getUTCHours()}`.slice(-2)}:${`0${a.getMinutes()}`.slice(-2)}:${`0${a.getSeconds()}`.slice(-2)}+08:00`,remark:{[b]:c.busRemark||("1"===c.isScheduled?"en"===b?"Scheduled":"\u9810\u5B9A\u73ED\u6B21":"")},co:"lrtfeeder"}]},[])],[])),fetchStopEtas:a=>[]}},6895:function(a,c,b){let d=b(7934);a.exports={co:"mtr",fetchEtas:({stopId:a,route:b,bound:c})=>fetch(`https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?line=${b}&sta=${a}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:d,status:e})=>0===e?[]:d[`${b}-${a}`]["U"===c.slice(-2,1)?"UP":"DOWN"].reduce((b,{time:c,plat:a,dest:d})=>[...b,{eta:c.replace(" ","T")+"+08:00",remark:{zh:`${a}號月台`,en:`Platform ${a}`},co:"mtr"}],[])),fetchStopEtas:a=>[]}},8144:function(a,c,b){let d=b(7934);a.exports={co:"nlb",fetchEtas:({stopId:a,nlbId:b})=>fetch("https://rt.data.gov.hk/v1/transport/nlb/stop.php?action=estimatedArrivals",{body:JSON.stringify({routeId:b,stopId:a,language:"zh"}),headers:{"Content-Type":"text/plain"},method:"POST",cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({estimatedArrivals:a})=>a?a.filter(a=>a.estimatedArrivalTime).map(a=>({eta:a.estimatedArrivalTime.replace(" ","T")+".000+08:00",remark:{zh:"",en:""},co:"nlb"})):[]),fetchStopEtas:a=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NLB/${a}`,{cache:"reload"}).then(a=>{if(a.ok)return a.json();throw new Error("Stop not exist")}).then(({data:a})=>a.map(a=>({route:a.route,eta:a.eta,dest:{en:a.dest},remark:{en:a.rmk},co:"nlb"}))).catch(()=>[])}},5982:function(a,c,b){let d=b(7934);a.exports={co:"nwfb",fetchEtas:({stopId:a,route:b,bound:c,seq:e})=>fetch(`https://rt.data.gov.hk//v1/transport/citybus-nwfb/eta/NWFB/${a}/${b}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.filter(a=>a.eta&&c.includes(a.dir)).sort((a,b)=>Math.abs(a.seq-e)<Math.abs(b.seq-e)?-1:1).filter((a,c,b)=>a.seq===b[0].seq).map(a=>({eta:a.eta,remark:{zh:a.rmk_tc,en:a.rmk_en},co:"nwfb"}))),fetchStopEtas:a=>fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${a}`,{cache:d.isSafari?"default":"no-store"}).then(a=>a.json()).then(({data:a})=>a.map(a=>({route:a.route,bound:a.dir,seq:a.seq,eta:a.eta,dest:{en:a.dest.replace("/","\uFF0F")},remark:{en:a.rmk},serviceType:1,co:"nwfb"})))}},9080:function(b,c,a){let d=a(9271),e=a(5982),f=a(7783),g=a(8144),h=a(8453),i=a(7238),j=a(2599),k=a(6895);b.exports={async fetchEtas({route:m,stops:b,bound:n,dest:o,seq:c,serviceType:p,co:q,nlbId:r,gtfsId:s,language:t}){try{let a=[];for(let l of q)"kmb"===l&&b.kmb?a=a.concat(await d.fetchEtas({route:m,stopId:b.kmb[c],seq:c,serviceType:p,bound:n[l]})):"ctb"===l&&b.ctb?a=a.concat(await f.fetchEtas({stopId:b.ctb[c],route:m,bound:n[l],seq:c})):"nwfb"===l&&b.nwfb?a=a.concat(await e.fetchEtas({stopId:b.nwfb[c],route:m,bound:n[l],seq:c})):"nlb"===l&&b.nlb?a=a.concat(await g.fetchEtas({stopId:b.nlb[c],nlbId:r})):"lrtfeeder"===l&&b.lrtfeeder?a=a.concat(await h.fetchEtas({stopId:b.lrtfeeder[c],route:m,language:t})):"gmb"===l&&b.gmb?a=a.concat(await i.fetchEtas({stopId:b.gmb[c],gtfsId:s,seq:c,bound:n[l]})):"lightRail"===l&&b.lightRail?a=a.concat(await j.fetchEtas({stopId:b.lightRail[c],route:m,dest:o})):"mtr"===l&&b.mtr&&(a=a.concat(await k.fetchEtas({stopId:b.mtr[c],route:m,bound:n.mtr})));return a.sort((a,b)=>""===a.eta?1:""===b.eta?-1:a.eta<b.eta?-1:1)}catch(u){return console.error(u),[]}},fetchEtaObj:()=>fetch("https://hkbus.github.io/hk-bus-crawling/routeFareList.min.json").then(a=>a.json()),fetchEtaObjMd5:()=>fetch("https://hkbus.github.io/hk-bus-crawling/routeFareList.md5").then(a=>a.text())}},7934:function(a){a.exports={isSafari:navigator&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!(navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/"))}}}])